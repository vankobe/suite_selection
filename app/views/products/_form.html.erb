<script>
  var SearchType = {};
  SearchType = {
    search: function(category){
      var category_id = category.val();
      $.ajax({
        type: "POST",
        url: "/api/get_type_from_category/",
        dataType: "html",
        data: {category_id: category_id},
        success: function(html){
          category.parent().append(html)
        },
        error: function() {
        }
      });
    }
  };

  var ProductContent={}
  ProductContent ={
    check: function(){
      
    }
  }
  $(function(){
    $("#product_content_category_id").on("change", function(){
      $("#product_type").remove();
      SearchType.search($(this));
    });
//    $(".flavors ").on("change", function(){
//      var flavor_id = $(this).attr("data-flavor_id");
//      if ($(this).find("input[type=number]").val() != 0){
//        if ($(this).find("input[type=hidden]").size() == 0) {
//        $("<input />").attr('type', 'hidden')
//                      .attr('name', "product_content[flavor_"+ flavor_id +"][flavor_id]")
//                      .attr('value', flavor_id)
//                      .appendTo($(this));
//        }
//      } else {
//        $(this).find("input[type=hidden]").remove();
//      }
//    });
  });
</script>
<style>
  #product_currency_id {
    width:50px;
  }
  .flavors {
    display:inline;
    float: left;
  }
</style>
<%= form_tag({:controller => "products", :action => "create"}, :class => "span10") do  %>
  <% if @product.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@product.errors.count, "error") %> prohibited this product from being saved:</h2>

      <ul>
      <% @product.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

<table class="table  table-bordered table-striped">
  <tr>
    <th class="span2">国名</th>
    <td>
      <%= select :product, :country_id, options_for_select(MasterTable::CountryJp::Options, :selected => @product.country_id)%>
    </td>
  </tr>
  <tr>
    <th>商品名</th>
    <td>
      <input id="product_name" name="product[name]" type="text" value="<%= @product.name %>" />
    </td>
  </tr>
  <tr>
    <th>値段</th>
    <td>
     <%= select :product, :currency_id, options_for_select(MasterTable::Currency::Options, :selected => @product.currency_id) %>
     <input id="product_price" name="product[price]" type="text" value="<%= @product.price %>" />
    </td>
  </tr>
  <%- contents = @product.try(:contents) || []
      if contents.present?
        contents.each do |content| -%>
          <%= render :partial => 'product_content_form', :locals => {:category_id => content.category_id, :flavor_id => content.flavor_id, :quantity => content.quantity} %>
        <%- end -%>
      <%- else -%>
        <%= render :partial => 'product_content_form' %>
      <%- end -%>
  <tr>
    <th>販売ページ</th>
    <td>
      <input id="product_url" name="product[url]" type="text" value="<%= @product.url %>" />
    </td>
  </tr>
</table>
  <input id="product_shop_id" name="product[shop_id]"type="hidden" value=<%=@shop_id %>>
  <div class="actions">
    <%= submit_tag "保存" %>
  </div>
<% end %>
